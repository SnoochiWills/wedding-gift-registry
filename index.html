<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wedding Gift Registry</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f7f7f7;
  padding: 20px;
  text-align: center;
}
h1 {
  color: #444;
}
ul {
  list-style: none;
  padding: 0;
  max-width: 550px;
  margin: 20px auto;
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
li {
  padding: 12px;
  border-bottom: 1px solid #eee;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
li:last-child {
  border-bottom: none;
}
.taken {
  text-decoration: line-through;
  color: gray;
}
.available {
  color: green;
}
button {
  padding: 5px 12px;
  cursor: pointer;
  border: none;
  border-radius: 4px;
  background: #007BFF;
  color: white;
}
button:hover {
  background: #0056b3;
}
</style>
</head>
<body>
<h1>Wedding Gift Registry</h1>
<p>Click <strong>Reserve</strong> to claim a gift. Reserved gifts will appear as <em>taken</em> with the reserver's name.</p>
<ul id="gift-list"></ul>

<script>
const apiUrl = "https://script.google.com/macros/s/AKfycbwsEpQKSBfkFbJnluyEdqvft3xhKe4GrwnLJm3PAVG52VzOItvCrj-Smp-FJyJqt3HZvQ/exec";
const giftList = document.getElementById("gift-list");

// Preload list for instant display
const preloadedGifts = [
  "Stove","Fridge","Stainless Steel cutlery","Stainless Steel cookware","Airfryer",
  "Toaster","Kettle (cordless)","Dinner plate/s","Glasses","Tea set/s",
  "Coffee mugs","Stand mixer/Hand mixer","Blender","Deep fryer","Microwave",
  "Coffee Maker","Tray Cutlery","Pot Holders","Dish Organiser","Pan Organiser",
  "Utensil Organiser"
];

function showPreloaded() {
  giftList.innerHTML = "";
  preloadedGifts.forEach(gift => {
    const li = document.createElement("li");
    li.textContent = gift + " - Available";
    li.classList.add("available");
    giftList.appendChild(li);
  });
}

async function loadGifts() {
  try {
    const res = await fetch(apiUrl);
    const data = await res.json();
    giftList.innerHTML = "";

    data.slice(1).forEach((row, i) => {
      const [gift, status, reservedBy] = row;
      if (!gift) return;

      const li = document.createElement("li");
      li.textContent = gift;

      if (status && status.toLowerCase() === "taken") {
        li.classList.add("taken");
        li.textContent += ` - Reserved by: ${reservedBy}`;
      } else {
        li.classList.add("available");
        const btn = document.createElement("button");
        btn.textContent = "Reserve";
        btn.onclick = () => reserveGift(i + 2, gift);
        li.appendChild(btn);
      }

      giftList.appendChild(li);
    });
  } catch (err) {
    console.error(err);
    giftList.innerHTML = "<li>Unable to load gifts. Showing preloaded list.</li>";
    showPreloaded();
  }
}

async function reserveGift(rowIndex, giftName) {
  const name = prompt(`Enter your name to reserve "${giftName}":`);
  if (!name) return;

  try {
    await fetch(apiUrl, {
      method: 'POST',
      body: JSON.stringify({ rowIndex, name })
    });
    loadGifts();
  } catch (err) {
    alert("Error reserving gift: " + err);
  }
}

// Initial display
showPreloaded();
loadGifts();

// Refresh every 10 seconds for live updates
setInterval(loadGifts, 10000);
</script>
</body>
</html>
