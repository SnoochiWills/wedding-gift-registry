<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wedding Gift Registry</title>
<style>
body { font-family: Arial; background: #f7f7f7; padding: 20px; text-align: center; }
h1 { color: #444; }
ul { list-style: none; padding: 0; max-width: 500px; margin: 20px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
li { padding: 12px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
li:last-child { border-bottom: none; }
.taken { text-decoration: line-through; color: gray; }
.available { color: green; }
button { padding: 5px 10px; }
</style>
</head>
<body>
<h1>Wedding Gift Registry</h1>
<p>Please choose from the list below. Items marked as <em>taken</em> are already reserved.</p>
<ul id="gift-list"></ul>

<script>
const apiUrl = "https://script.google.com/macros/s/AKfycbyRlniqJFYYPSOzTir3wpYBN83JtY0EgLHZIv9w6W-q6E0dM8mUtzvOWWhFCJeJGcwzkA/exec";
const giftList = document.getElementById("gift-list");

// Pre-load all gifts so page isn't empty on first load
const preloadedGifts = [
  "Stove","Fridge","Stainless Steel cutlery","Stainless Steel cookware","Airfryer",
  "Toaster","Kettle (cordless)","Dinner plate/s","Glasses","Tea set/s",
  "Coffee mugs","Stand mixer/Hand mixer","Blender","Deep fryer","Microwave",
  "Coffee Maker","Tray Cutlery","Pot Holders","Dish Organiser","Pan Organiser",
  "Utensil Organiser",
  "......."
];

// Display preloaded gifts instantly
function showPreloaded() {
  giftList.innerHTML = "";
  preloadedGifts.forEach(gift => {
    const li = document.createElement("li");
    li.textContent = gift + " - Available";
    li.classList.add("available");
    giftList.appendChild(li);
  });
}

// Load live gifts from Apps Script
async function loadGifts() {
  try {
    const res = await fetch(apiUrl);
    const data = await res.json(); 

    giftList.innerHTML = "";

    data.slice(1).forEach((row, i) => { 
      const [gift, status, reservedBy] = row;
      if (!gift) return;

      const li = document.createElement("li");
      li.textContent = gift;

      if (status && status.toLowerCase() === "taken") {
        li.classList.add("taken");
        li.textContent += ` - Reserved by: ${reservedBy}`;
      } else {
        li.classList.add("available");
        const btn = document.createElement("button");
        btn.textContent = "Reserve";
        btn.onclick = () => reserveGift(i + 2, gift); 
        li.appendChild(btn);
      }

      giftList.appendChild(li);
    });

  } catch (err) {
    console.error("Error loading gifts:", err);
    giftList.innerHTML = "<li>Unable to load gifts. Showing preloaded list.</li>";
    showPreloaded();
  }
}

async function reserveGift(rowIndex, giftName) {
  const name = prompt(`Enter your name to reserve "${giftName}":`);
  if (!name) return;

  try {
    await fetch(apiUrl, {
      method: 'POST',
      body: JSON.stringify({ rowIndex, name })
    });
    loadGifts(); 
  } catch (err) {
    alert("Error reserving gift: " + err);
  }
}

// Show preloaded list instantly
showPreloaded();

// Then load live gifts
loadGifts();

// Refresh every 10 seconds
setInterval(loadGifts, 10000);
</script>
</body>
</html>
